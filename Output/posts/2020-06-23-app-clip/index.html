<!DOCTYPE html><html lang="en"><head><title>Povilas Staškus - iOS Developer</title><meta name="twitter:title" content="Povilas Staškus - iOS Developer"/><meta name="og:title" content="Povilas Staškus - iOS Developer"/><meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous"/><link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-min.css"/><link rel="stylesheet" href="/Pure/styles.css"/><link rel="stylesheet" href="/all.css"/></head><body><div id="layout" class="pure-g"><div><div class="pure-menu pure-menu-horizontal pure-u-1-1 top-header"><a class="pure-menu-heading" href="/">staskus.io</a><ul class="pure-menu-list"><li class="pure-menu-item"><a class="pure-menu-link" href="/about">About</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/notes">Notes</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/afterWork">After work</a></li></ul></div></div><div class="sidebar pure-u-1 pure-u-md-1-4"><div class="header"><div id="layout" class="pure-g"><div class="author__avatar"><img src="https://avatars0.githubusercontent.com/u/4062343?s=460&v=4"/></div><div class="pure-u-md-1-1 pure-u-3-4"><h1 class="brand-title">Povilas Staškus</h1><h3 class="brand-tagline">iOS Developer</h3></div></div><div id="layout" class="pure-g"><div class="pure-u-md-1-1"><a href="https://en.wikipedia.org/wiki/Vilnius"><i class="fas fa-map-marker-alt l-box social-icon"></i><a class="social-media" href="https://en.wikipedia.org/wiki/Vilnius">Vilnius, Lithuania</a></a></div><div class="pure-u-md-1-1"><a href="mailto:povilas@staskus.io"><i class="fas fa-envelope-open-text l-box social-icon"></i><a class="social-media" href="mailto:povilas@staskus.io">Email</a></a></div><div class="pure-u-md-1-1"><a href="https://www.linkedin.com/in/povilas-staškus-6b10528b"><i class="fab fa-linkedin l-box social-icon"></i><a class="social-media" href="https://www.linkedin.com/in/povilas-staškus-6b10528b">LinkedIn</a></a></div><div class="pure-u-md-1-1"><a href="https://github.com/staskus"><i class="fab fa-github-square l-box social-icon"></i><a class="social-media" href="https://github.com/staskus">GitHub</a></a></div><div class="pure-u-md-1-1"><a href="https://twitter.com/PovilasStaskus"><i class="fab fa-twitter-square l-box social-icon"></i><a class="social-media" href="https://twitter.com/PovilasStaskus">Twitter</a></a></div></div></div></div><div class="content pure-u-1 pure-u-md-3-5 pure-u-xl-6-10"><h2 class="post-title"><a href="/posts/2020-06-23-app-clip">App Clips: A first glance at the new way to access an iOS app</a></h2><p class="post-meta">2020 June 23</p><div class="post-tags"><a class="post-category post-category-swift" href="/tags/swift">Swift</a><a class="post-category post-category-ios 14" href="/tags/ios-14">iOS 14</a><a class="post-category post-category-app clip" href="/tags/app-clip">App Clip</a><a class="post-category post-category-tutorial" href="/tags/tutorial">Tutorial</a></div><div class="post-description"><div><p>During <a href="https://developer.apple.com/wwdc20/">WWDC20</a> Apple is introducing new <a href="https://developer.apple.com/app-clips/">App Clips</a> feature. As it's described in the landing page:</p><blockquote><p>An app clip is a small part of your app that’s discoverable at the moment it’s needed.</p></blockquote><p>Apple already suggested some possible use cases such as ordering from a take-out restaurant or renting a scooter. And App Clips will be discovered and invoked by using new App Clip Codes, NFC Tags, QR Codes, Messages, or as place cards in Maps.</p><p>It looks like a great move forward in reducing friction and getting an app into users' hands as fast as possible.</p><p>We'll take a look at the initial steps of how these App Clips could be implemented and introduced in the project.</p><h1>Prerequisites</h1><p>Xcode 12 or higher.</p><h1>Getting Started</h1><p>We start by creating a new project and selecting the creation of a new target.</p><img src="/images/app-clip/new_target.png" alt="App Clip New Target" width="600"/><p>We select a new App Clip target and add it to our application.</p><img src="/images/app-clip/new_target_app_clip.png" alt="App Clip New Target" width="600"/><h1>Add Associated Domain</h1><p>We need to provide an associated domain for both App and App Clip targets. If App is not installed the link will open App Clip. Otherwise full App will be opened instead.</p><p>We do it by selecting <em>Target -&gt; Signing &amp; Capabilities</em>, clicking + sign, and choosing Associated Domains.</p><img src="/images/app-clip/associated_domains.png" alt="Creating Associated Domain" width="600"/><p>Next, we enter our associated domain value which must follow pattern of <em>appclips:domain</em>. In this instance, we can enter <em>appclips:example.com</em>.</p><img src="/images/app-clip/associated_domains_example.png" alt="Associated Domains Example" width="600"/><h1>Running App Clip target</h1><p>App Clip target can be run and debugged just like an App target.</p><p>We can open <code>ContentView.swift</code> inside an App Clip target, make changes, and run.</p><pre><code><span class="keyword">struct</span> ContentView: <span class="type">View</span> {
    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {
        <span class="type">Text</span>(<span class="string">"Hello, App Clip!"</span>).<span class="call">padding</span>()
    }
}
</code></pre><img src="/images/app-clip/hello_app_clip.png" alt="Hello App Clip Simulator Screen" width="300"/><h1>Configuring App Clip</h1><p>App Clip is invoked via URL which can contain context-related information and be used in the configuration.</p><p>Let's say we want to provide a user with a more personalized greeting message after App Clip was invoked. We can pass binding <code>name</code> variable to <code>ContentView</code>.</p><pre><code><span class="keyword">struct</span> ContentView: <span class="type">View</span> {
    <span class="keyword">@Binding var</span> name: <span class="type">String</span>

    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {
        <span class="type">Text</span>(<span class="string">"Hello,</span> \(name)<span class="string">"</span>).<span class="call">padding</span>()
    }
}
</code></pre><p>This example uses a new App lifecycle in SwiftUI which enables entire apps to be written completely in SwiftUI.</p><p>Information about invocation is passed through lifecycle events. We can use <code>onContinueUserActivity</code> to be notified about App Clip being launched with parameters.</p><p>More information about using legacy lifecycles can be found on <a href="https://developer.apple.com/documentation/app_clips/responding_to_invocations">Access the Invocation URL section</a>.</p><p>After that, we take the incoming URL and its first path component. Now first path parameter passed through URL will be set as a name.</p><pre><code><span class="keyword">@main
struct</span> AppClipSneakPeekClipApp: <span class="type">App</span> {
    <span class="keyword">@State var</span> name = <span class="string">""</span>

    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">Scene</span> {
        <span class="type">WindowGroup</span> {
            <span class="type">ContentView</span>(name: $name).<span class="call">onContinueUserActivity</span>(<span class="type">NSUserActivityTypeBrowsingWeb</span>, perform: respondTo)
        }
    }

    <span class="keyword">func</span> respondTo(<span class="keyword">_</span> activity: <span class="type">NSUserActivity</span>?) {
        <span class="keyword">guard let</span> name = <span class="call">firstParameterValue</span>(from: activity) <span class="keyword">else</span> { <span class="keyword">return</span> }

        <span class="keyword">self</span>.<span class="property">name</span> = name
    }

    <span class="keyword">private func</span> firstParameterValue(from activity: <span class="type">NSUserActivity</span>?) -&gt; <span class="type">String</span>? {
        <span class="comment">// Parsing components from URL</span>
        <span class="keyword">guard let</span> activity = activity <span class="keyword">else</span> { <span class="keyword">return nil</span> }
        <span class="keyword">guard let</span> incomingURL = activity.<span class="property">webpageURL</span> <span class="keyword">else</span> { <span class="keyword">return nil</span> }
        <span class="keyword">guard let</span> components = <span class="type">NSURLComponents</span>(url: incomingURL, resolvingAgainstBaseURL: <span class="keyword">true</span>) <span class="keyword">else</span> { <span class="keyword">return nil</span> }

        <span class="comment">// Taking first parameter: example.com/?parameter=Lisa</span>
        <span class="keyword">return</span> components.<span class="property">queryItems</span>?.<span class="property">first</span>?.<span class="property">value</span>
    }
}
</code></pre><h1>Testing</h1><p>Launching AppClip target now does not show any name value. It makes sense as we didn't pass any URL with parameters to our app.</p><p>We can automatically test it by providing <em>Environment Variable</em> for App Clip scheme. It can be done by selecting <code>App Clip scheme -&gt; Edit Scheme -&gt; Run</code> and set the value of <em>_XCAppClipURL</em> of test URL value. We set it to <em>https://example.com/?parameter=Lisa</em> to have a first parameter value.</p><img src="/images/app-clip/testing.png" alt="Adding Environment Variable" width="600"/><p>If we launch the application now, the value is received through lifecycle event and updated inside a view.</p><img src="/images/app-clip/testing_success.png" alt="iOS Simulator with result" width="300"/><h2>What about App Clip Card?</h2><p>App Clip Card itself that is shown with a suggestion to open an App Card is not developed through Xcode. The information displayed in this card can be configured through <a href="https://appstoreconnect.apple.com/login">App Store Connect</a>. Developers will be able to change a header image, subtitle, and title on the action button.</p><h1>Where do we go from here?</h1><p>App Clip looks like a promising addition to the ecosystem and it will be interesting to see how it will be used and adopted by both developers and users.</p><p>The example project can be found on <a href="https://github.com/staskus/AppClipSneakPeekApp">GitHub</a>.</p><p>Apple provides a lot of helpful resources for going more in-depth into App Clips.</p><ul><li><a href="https://developer.apple.com/documentation/app_clips">Developing a Great App Clip</a></li><li><a href="https://developer.apple.com/documentation/app_clips/creating_an_app_clip">Creating an App Clip</a></li><li><a href="https://developer.apple.com/documentation/app_clips/responding_to_invocations">Responding to Invocation</a></li><li><a href="https://developer.apple.com/documentation/app_clips/configuring_your_app_clip_s_launch_experience">Configuring Your App Clip’s Launch Experience</a></li><li><a href="https://developer.apple.com/documentation/app_clips/configuring_your_app_clip_s_launch_experience">Testing Your App Clip’s Launch Experience</a></li></ul></div></div></div><div class="footer pure-u-1"><div class="pure-u-1">© 2022 Povilas Staškus</div><div class="pure-u-1">Generated using <a href="https://github.com/johnsundell/publish">Publish</a></div><div class="pure-u-1"><a href="/feed.rss">RSS feed</a></div></div></div></body></html>